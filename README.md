# Braid

## What is Braid?
Braid is a pattern library tool for Laravel (+ Livewire) projects.

It enables developers to view components and markup in isolation, allowing for a consistent, clutter-free view of the atomic structure of their layouts.

### How does it work?
Patterns are defined using PHP classes which extend one of the base Braid pattern classes, for example:

```php
namespace Tests\Patterns\Components;

use Illuminate\View\View;
use njpanderson\Braid\Base\ComponentPattern;

class Button extends ComponentPattern {
    protected $contexts = [
        'default',
        'red',
        'submit'
    ];

    public function contextData(string $context): array|View
    {
        switch ($context) {
        case 'submit':
            return view('patterns.components.button.submit');

        case 'red':
            return $this->makeContext(
                attributes: [
                    'class' => 'bg-red-400 text-2xl'
                ],
                slot: 'Submit, in red!'
            );

        default:
            return $this->makeContext(
                slot: 'Button'
            );
        }
    }
}
```

The above example defines a `Button` blade component, assuming the same component exists in your Laravel project `app/View/Components/Button.php` (and/or `resources/views/components/button.blade.php`), or wherever you store your components and their views.

It defines three **contexts**, which are essentially variations on the same component, allowing you to see the button component in three different ways.

The `red` and `default` contexts have been generated by the `makeContext` method. These context data will be sent to the `<x-button/>` component to define its behaviour.

The `submit` context is a complete view file, responsible for displaying the component on its own. In this example, it is stored at `resources/views/patterns/components/button/submit.blade.php`, but it can be anywhere you like.

#### Why use view files?

View files can be useful for displaying the component or combinations of components in ways not covered by a context object, for instance, if you would like to create an "organism" pattern which may be the combination of multiple patterns on a single page.

## Installing Braid
Braid can be installed via [Composer](https://getcomposer.org):

```
$ composer require njpanderson/braid
```

After the Braid is installed, its resources and assets can be installed with a single command:

```
$ php artisan braid:install
```

If all goes well, you should be able to access `/braid` within your project.

### Enabling database storage
Each pattern in Braid can be assigned shared metadata such as notes or the build status of a pattern. This metadata is stored using a database table and is accessible to anyone viewing Braid on the same environment.

It is not enabled by default, but if you would like to enable this, you can publish the migrations:

```
$ php artisan vendor:publish --tag=braid-migrations
$ php artisan migrate
```

If you would like to configure the database connection Braid uses for storing pattern metadata, you can do so within the braid [config file](#configuring-your-project).

## Configuring your project
The `braid:install` command will place a `config/braid.php` file in your application. This can be used to configure various components of Braid:

item | description
--- | ---
`title` | The title shown on the pattern library interface.
`path` | The path at which the pattern library can be found.
`patterns.namespace` | Defaulting to `Test\Patterns`, this is where Braid will look for your pattern definitions.
`theme` | ...
`response_sizes` | ...
`middleware` | ...
`vendor_path` | ...
`exceptions` | In some cases (such as malformed template definitions), a Braid exception will show in place of a Laravel driven exception with full stack traces. If you want to disable these, set `exceptions` to `false`.
`database.connection` | ...

### Defining your patterns
...

### Creating a pattern layout
...

## Configuring Braid
...

### Authorising requests

Braid is accessible in `local` environments to all visitors. By default, it cannot be viewed on any other environment.

If you would like to determine Braid's visibility on other environments, you can alter the `braidGate` method within `App\Providers\BraidServiceProvider`.

You should return a boolean from this method determining whether or not the visitor has access. For example:

```php
use Illuminate\Http\Request;

protected function braidGate(Request $request): bool
{
    return in_array($request->user()->email, [
        'admin@example.com'
    ]);
}
```

Braid expects the return value of the `authorizeWith` callback to be a boolean `true` or `false`, the value of which will determine whether or not the visitor has access.

## Extending Braid
...